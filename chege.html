<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Color Studio</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #2d3748;
      min-height: 100%;
      padding: 20px;
      overflow-x: hidden;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .title {
      font-size: 3rem;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 10px;
      letter-spacing: -0.02em;
    }

    .subtitle {
      font-size: 1.2rem;
      color: #64748b;
      font-weight: 400;
    }

    .main-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      margin-bottom: 40px;
    }

    .color-picker-section {
      background: #f8fafc;
      border-radius: 20px;
      padding: 30px;
      border: 2px solid #e2e8f0;
      transition: all 0.3s ease;
    }

    .color-picker-section:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.1);
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .color-input-wrapper {
      position: relative;
      margin-bottom: 25px;
    }

    .color-input {
      width: 100%;
      height: 120px;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .color-input:hover {
      transform: scale(1.02);
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
    }

    .color-display {
      width: 100%;
      height: 80px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 3px solid #e2e8f0;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .color-display::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 25%, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.1) 50%, transparent 50%, transparent 75%, rgba(255,255,255,0.1) 75%);
      background-size: 20px 20px;
      animation: shimmer 2s linear infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .color-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .info-card {
      background: white;
      padding: 15px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      text-align: center;
      transition: all 0.3s ease;
    }

    .info-card:hover {
      border-color: #667eea;
      transform: translateY(-1px);
    }

    .info-label {
      font-size: 0.8rem;
      font-weight: 600;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 5px;
    }

    .info-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: #1e293b;
      font-family: 'Monaco', monospace;
    }

    .palette-section {
      grid-column: 1 / -1;
      background: #f8fafc;
      border-radius: 20px;
      padding: 30px;
      border: 2px solid #e2e8f0;
    }

    .palette-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 25px;
      text-align: center;
    }

    .color-palette {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .palette-color {
      aspect-ratio: 1;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 3px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .palette-color:hover {
      transform: scale(1.1);
      border-color: white;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }

    .palette-color.active {
      border-color: #667eea;
      transform: scale(1.05);
    }

    .gradient-section {
      margin-top: 30px;
    }

    .gradient-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 15px;
    }

    .gradient-display {
      height: 60px;
      border-radius: 12px;
      margin-bottom: 15px;
      border: 2px solid #e2e8f0;
      transition: all 0.3s ease;
    }

    .gradient-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .gradient-btn {
      padding: 8px 16px;
      border: 2px solid #e2e8f0;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      color: #64748b;
      transition: all 0.3s ease;
    }

    .gradient-btn:hover {
      border-color: #667eea;
      color: #667eea;
      transform: translateY(-1px);
    }

    .gradient-btn.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .copy-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #10b981;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 500;
      transform: translateX(100%);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .copy-notification.show {
      transform: translateX(0);
    }

    .form-section {
      grid-column: 1 / -1;
      background: #f8fafc;
      border-radius: 20px;
      padding: 30px;
      border: 2px solid #e2e8f0;
      margin-top: 20px;
    }

    .form-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 25px;
      text-align: center;
    }

    .color-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-label {
      font-size: 0.9rem;
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
    }

    .form-input {
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: white;
    }

    .form-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-textarea {
      min-height: 80px;
      resize: vertical;
    }

    .image-upload-area {
      grid-column: 1 / -1;
      border: 2px dashed #cbd5e1;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      background: #f8fafc;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }

    .image-upload-area:hover {
      border-color: #667eea;
      background: #f1f5f9;
    }

    .image-upload-area.dragover {
      border-color: #667eea;
      background: #eff6ff;
    }

    .upload-icon {
      font-size: 3rem;
      margin-bottom: 15px;
      color: #94a3b8;
    }

    .upload-text {
      font-size: 1.1rem;
      color: #64748b;
      margin-bottom: 10px;
    }

    .upload-subtext {
      font-size: 0.9rem;
      color: #94a3b8;
    }

    .image-preview {
      max-width: 200px;
      max-height: 200px;
      border-radius: 8px;
      margin: 15px auto;
      display: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .submit-btn {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .loading-spinner {
      display: none;
      width: 20px;
      height: 20px;
      border: 2px solid transparent;
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .saved-colors {
      margin-top: 30px;
    }

    .saved-colors-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 20px;
    }

    .saved-color-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .saved-color-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      border: 2px solid #e2e8f0;
      transition: all 0.3s ease;
      position: relative;
    }

    .saved-color-card:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .saved-color-preview {
      width: 100%;
      height: 60px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 2px solid #e2e8f0;
    }

    .saved-color-info h3 {
      font-size: 1.1rem;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 8px;
    }

    .saved-color-details {
      font-size: 0.9rem;
      color: #64748b;
      line-height: 1.4;
    }

    .saved-color-image {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 8px;
      margin-top: 10px;
    }

    .delete-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ef4444;
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.3s ease;
    }

    .delete-btn:hover {
      background: #dc2626;
      transform: scale(1.1);
    }

    .location-display {
      font-size: 0.8rem;
      color: #10b981;
      font-weight: 500;
      margin-top: 5px;
    }

    /* Tablet styles */
    @media (max-width: 1024px) {
      .container {
        padding: 30px;
        margin: 15px;
      }
      
      .main-content {
        gap: 30px;
      }
      
      .color-form {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .saved-color-grid {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 15px;
      }
    }

    /* Mobile styles */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .container {
        padding: 20px;
        margin: 5px;
        border-radius: 16px;
      }
      
      .main-content {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .title {
        font-size: 2.2rem;
        line-height: 1.2;
      }
      
      .subtitle {
        font-size: 1rem;
      }
      
      .color-picker-section,
      .palette-section,
      .form-section {
        padding: 20px;
      }
      
      .section-title {
        font-size: 1.3rem;
      }
      
      .color-input {
        height: 100px;
      }
      
      .color-display {
        height: 60px;
      }
      
      .color-info {
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      
      .info-card {
        padding: 12px;
      }
      
      .info-value {
        font-size: 0.9rem;
      }
      
      .color-palette {
        grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
        gap: 8px;
      }
      
      .gradient-controls {
        justify-content: center;
      }
      
      .gradient-btn {
        padding: 6px 12px;
        font-size: 0.8rem;
      }
      
      .color-form {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .form-input {
        padding: 10px 14px;
        font-size: 16px; /* Prevents zoom on iOS */
      }
      
      .image-upload-area {
        padding: 30px 20px;
      }
      
      .upload-icon {
        font-size: 2.5rem;
      }
      
      .upload-text {
        font-size: 1rem;
      }
      
      .submit-btn {
        padding: 12px 24px;
        font-size: 1rem;
      }
      
      .saved-color-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .saved-color-card {
        padding: 15px;
      }
      
      .saved-color-preview {
        height: 50px;
      }
      
      .saved-color-image {
        height: 100px;
      }
    }

    /* Small mobile styles */
    @media (max-width: 480px) {
      .title {
        font-size: 1.8rem;
      }
      
      .subtitle {
        font-size: 0.9rem;
      }
      
      .color-picker-section,
      .palette-section,
      .form-section {
        padding: 15px;
      }
      
      .color-info {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      
      .info-card {
        padding: 10px;
      }
      
      .color-palette {
        grid-template-columns: repeat(auto-fit, minmax(45px, 1fr));
        gap: 6px;
      }
      
      .gradient-controls {
        flex-direction: column;
        gap: 8px;
      }
      
      .gradient-btn {
        width: 100%;
        text-align: center;
      }
      
      .image-upload-area {
        padding: 20px 15px;
      }
      
      .upload-icon {
        font-size: 2rem;
      }
      
      .upload-text {
        font-size: 0.9rem;
      }
      
      .upload-subtext {
        font-size: 0.8rem;
      }
      
      .copy-notification {
        right: 10px;
        left: 10px;
        transform: translateY(-100%);
        top: auto;
        bottom: 20px;
      }
      
      .copy-notification.show {
        transform: translateY(0);
      }
    }

    /* Landscape mobile optimization */
    @media (max-width: 768px) and (orientation: landscape) {
      .main-content {
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      
      .palette-section,
      .form-section {
        grid-column: 1 / -1;
      }
    }

    /* Touch-friendly improvements */
    @media (hover: none) and (pointer: coarse) {
      .palette-color {
        min-height: 50px;
        min-width: 50px;
      }
      
      .gradient-btn,
      .submit-btn,
      .delete-btn {
        min-height: 44px;
        min-width: 44px;
      }
      
      .info-card {
        min-height: 60px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>

 </head>
 <body>
  <div class="container">
   <header class="header">
    <h1 class="title" id="appTitle">üé® Advanced Color Studio</h1>
    <p class="subtitle" id="subtitleText">Discover, create, and explore beautiful colors with our advanced picker</p>
   </header>
   <main class="main-content">
    <section class="color-picker-section">
     <h2 class="section-title"><span>üéØ</span> Color Picker</h2>
     <div class="color-input-wrapper"><input type="color" class="color-input" id="colorPicker" value="#667eea">
     </div>
     <div class="color-display" id="colorDisplay"></div>
     <div class="color-info">
      <div class="info-card" onclick="copyToClipboard('hex')">
       <div class="info-label">
        HEX
       </div>
       <div class="info-value" id="hexValue">
        # 667eea
       </div>
      </div>
      <div class="info-card" onclick="copyToClipboard('rgb')">
       <div class="info-label">
        RGB
       </div>
       <div class="info-value" id="rgbValue">
        rgb(102, 126, 234)
       </div>
      </div>
      <div class="info-card" onclick="copyToClipboard('hsl')">
       <div class="info-label">
        HSL
       </div>
       <div class="info-value" id="hslValue">
        hsl(225, 73%, 66%)
       </div>
      </div>
      <div class="info-card" onclick="copyToClipboard('cmyk')">
       <div class="info-label">
        CMYK
       </div>
       <div class="info-value" id="cmykValue">
        56, 46, 0, 8
       </div>
      </div>
     </div>
    </section>
    <section class="color-picker-section">
     <h2 class="section-title"><span>üåà</span> Color Harmony</h2>
     <div class="gradient-title">
      Generated Gradient
     </div>
     <div class="gradient-display" id="gradientDisplay"></div>
     <div class="gradient-controls"><button class="gradient-btn active" onclick="setGradientType('linear')">Linear</button> <button class="gradient-btn" onclick="setGradientType('radial')">Radial</button> <button class="gradient-btn" onclick="setGradientType('conic')">Conic</button>
     </div>
    </section>
    <section class="palette-section">
     <h2 class="palette-title" id="paletteTitle">üé® Popular Color Palettes</h2>
     <div class="color-palette" id="colorPalette"></div>
    </section>
    <section class="form-section">
     <h2 class="form-title" id="formTitle">üíæ Save Your Color Project</h2>
     <form class="color-form" id="colorForm">
      <div class="form-group"><label class="form-label" for="projectName">Project Name</label> <input type="text" id="projectName" class="form-input" placeholder="Enter project name" required>
      </div>
      <div class="form-group"><label class="form-label" for="location">Location</label> <input type="text" id="location" class="form-input" placeholder="Auto-detected or enter manually">
      </div>
      <div class="form-group"><label class="form-label" for="description">Description</label> <textarea id="description" class="form-input form-textarea" placeholder="Describe your color inspiration..."></textarea>
      </div>
      <div class="image-upload-area" id="imageUploadArea">
       <div class="upload-icon">
        üì∏
       </div>
       <div class="upload-text">
        Click to upload or drag &amp; drop an image
       </div>
       <div class="upload-subtext">
        PNG, JPG up to 5MB
       </div><input type="file" id="imageInput" accept="image/*" style="display: none;"> <img id="imagePreview" class="image-preview" alt="Preview">
      </div><button type="submit" class="submit-btn" id="submitBtn">
       <div class="loading-spinner" id="loadingSpinner"></div><span id="submitText">Save Color Project</span> </button>
     </form>
     <div class="saved-colors" id="savedColors">
      <h3 class="saved-colors-title">üìö Your Saved Projects</h3>
      <div class="saved-color-grid" id="savedColorGrid"></div>
     </div>
    </section>
   </main>
  </div>
  <div class="copy-notification" id="copyNotification">
   Color copied to clipboard! üìã
  </div>
  <script>
    // Configuration object
    const defaultConfig = {
      app_title: "üé® Advanced Color Studio",
      subtitle_text: "Discover, create, and explore beautiful colors with our advanced picker",
      palette_title: "üé® Popular Color Palettes",
      form_title: "üíæ Save Your Color Project",
      primary_color: "#667eea",
      secondary_color: "#764ba2",
      background_color: "#f8fafc",
      text_color: "#1e293b",
      accent_color: "#10b981"
    };

    // Data storage
    let savedProjects = [];
    let currentRecordCount = 0;

    // Color palettes
    const colorPalettes = [
      ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'],
      ['#6C5CE7', '#A29BFE', '#FD79A8', '#FDCB6E', '#E17055'],
      ['#00B894', '#00CEC9', '#0984E3', '#6C5CE7', '#A29BFE'],
      ['#E84393', '#FD79A8', '#FDCB6E', '#E17055', '#D63031'],
      ['#2D3436', '#636E72', '#B2BEC3', '#DDD', '#FFF'],
      ['#FF7675', '#74B9FF', '#81ECEC', '#00B894', '#FDCB6E']
    ];

    let currentGradientType = 'linear';
    let currentColor = '#667eea';

    // DOM elements
    const colorPicker = document.getElementById('colorPicker');
    const colorDisplay = document.getElementById('colorDisplay');
    const hexValue = document.getElementById('hexValue');
    const rgbValue = document.getElementById('rgbValue');
    const hslValue = document.getElementById('hslValue');
    const cmykValue = document.getElementById('cmykValue');
    const gradientDisplay = document.getElementById('gradientDisplay');
    const colorPaletteContainer = document.getElementById('colorPalette');
    const copyNotification = document.getElementById('copyNotification');

    // Initialize the app
    function init() {
      updateColorDisplay(currentColor);
      generateColorPalettes();
      updateGradient();
      setupFormHandlers();
      detectLocation();
      initDataSDK();
    }

    // Data SDK Handler
    const dataHandler = {
      onDataChanged(data) {
        savedProjects = data;
        currentRecordCount = data.length;
        renderSavedProjects();
      }
    };

    // Initialize Data SDK
    async function initDataSDK() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error("Failed to initialize data SDK");
        }
      }
    }

    // Setup form event handlers
    function setupFormHandlers() {
      const form = document.getElementById('colorForm');
      const imageUploadArea = document.getElementById('imageUploadArea');
      const imageInput = document.getElementById('imageInput');
      const imagePreview = document.getElementById('imagePreview');

      // Form submission
      form.addEventListener('submit', handleFormSubmit);

      // Image upload handlers
      imageUploadArea.addEventListener('click', () => imageInput.click());
      imageInput.addEventListener('change', handleImageUpload);

      // Drag and drop handlers
      imageUploadArea.addEventListener('dragover', handleDragOver);
      imageUploadArea.addEventListener('dragleave', handleDragLeave);
      imageUploadArea.addEventListener('drop', handleImageDrop);
    }

    // Handle form submission
    async function handleFormSubmit(e) {
      e.preventDefault();
      
      if (currentRecordCount >= 999) {
        showNotification("Maximum limit of 999 projects reached. Please delete some projects first.", "error");
        return;
      }

      const submitBtn = document.getElementById('submitBtn');
      const loadingSpinner = document.getElementById('loadingSpinner');
      const submitText = document.getElementById('submitText');

      // Show loading state
      submitBtn.disabled = true;
      loadingSpinner.style.display = 'inline-block';
      submitText.textContent = 'Saving...';

      try {
        const formData = {
          id: Date.now().toString(),
          project_name: document.getElementById('projectName').value,
          color_hex: currentColor,
          color_rgb: hexToRgb(currentColor),
          color_hsl: hexToHsl(currentColor),
          description: document.getElementById('description').value,
          location: document.getElementById('location').value,
          created_at: new Date().toISOString(),
          image_data: document.getElementById('imagePreview').src || ''
        };

        if (window.dataSdk) {
          const result = await window.dataSdk.create(formData);
          if (result.isOk) {
            showNotification("Color project saved successfully! üéâ", "success");
            form.reset();
            document.getElementById('imagePreview').style.display = 'none';
          } else {
            showNotification("Failed to save project. Please try again.", "error");
          }
        }
      } catch (error) {
        showNotification("An error occurred while saving.", "error");
      } finally {
        // Reset loading state
        submitBtn.disabled = false;
        loadingSpinner.style.display = 'none';
        submitText.textContent = 'Save Color Project';
      }
    }

    // Handle image upload
    function handleImageUpload(e) {
      const file = e.target.files[0];
      if (file) {
        processImageFile(file);
      }
    }

    // Handle drag and drop
    function handleDragOver(e) {
      e.preventDefault();
      e.currentTarget.classList.add('dragover');
    }

    function handleDragLeave(e) {
      e.currentTarget.classList.remove('dragover');
    }

    function handleImageDrop(e) {
      e.preventDefault();
      e.currentTarget.classList.remove('dragover');
      
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        processImageFile(files[0]);
      }
    }

    // Process image file
    function processImageFile(file) {
      if (file.size > 5 * 1024 * 1024) {
        showNotification("Image size must be less than 5MB", "error");
        return;
      }

      if (!file.type.startsWith('image/')) {
        showNotification("Please select a valid image file", "error");
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        const imagePreview = document.getElementById('imagePreview');
        imagePreview.src = e.target.result;
        imagePreview.style.display = 'block';
      };
      reader.readAsDataURL(file);
    }

    // Detect user location
    function detectLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          async (position) => {
            try {
              const { latitude, longitude } = position.coords;
              // For demo purposes, we'll show coordinates
              // In a real app, you'd use a geocoding service
              const locationText = `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
              document.getElementById('location').value = locationText;
            } catch (error) {
              console.log('Location detection failed');
            }
          },
          (error) => {
            console.log('Location access denied or failed');
          }
        );
      }
    }

    // Render saved projects
    function renderSavedProjects() {
      const grid = document.getElementById('savedColorGrid');
      grid.innerHTML = '';

      savedProjects.forEach(project => {
        const card = document.createElement('div');
        card.className = 'saved-color-card';
        
        card.innerHTML = `
          <button class="delete-btn" onclick="deleteProject('${project.__backendId}')" title="Delete project">√ó</button>
          <div class="saved-color-preview" style="background: ${project.color_hex}"></div>
          <div class="saved-color-info">
            <h3>${project.project_name}</h3>
            <div class="saved-color-details">
              <div><strong>HEX:</strong> ${project.color_hex}</div>
              <div><strong>RGB:</strong> ${project.color_rgb}</div>
              <div><strong>HSL:</strong> ${project.color_hsl}</div>
              ${project.description ? `<div><strong>Description:</strong> ${project.description}</div>` : ''}
              ${project.location ? `<div class="location-display">üìç ${project.location}</div>` : ''}
              <div><strong>Created:</strong> ${new Date(project.created_at).toLocaleDateString()}</div>
            </div>
            ${project.image_data ? `<img src="${project.image_data}" class="saved-color-image" alt="Project image">` : ''}
          </div>
        `;
        
        grid.appendChild(card);
      });
    }

    // Delete project
    async function deleteProject(backendId) {
      const project = savedProjects.find(p => p.__backendId === backendId);
      if (!project) return;

      if (window.dataSdk) {
        const result = await window.dataSdk.delete(project);
        if (result.isOk) {
          showNotification("Project deleted successfully", "success");
        } else {
          showNotification("Failed to delete project", "error");
        }
      }
    }

    // Show notification
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('copyNotification');
      notification.textContent = message;
      notification.style.background = type === 'success' ? '#10b981' : '#ef4444';
      notification.classList.add('show');
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Color picker event listener
    colorPicker.addEventListener('input', (e) => {
      currentColor = e.target.value;
      updateColorDisplay(currentColor);
      updateGradient();
    });

    // Update color display and values
    function updateColorDisplay(color) {
      colorDisplay.style.background = `linear-gradient(135deg, ${color}, ${adjustBrightness(color, -20)})`;
      
      hexValue.textContent = color.toUpperCase();
      rgbValue.textContent = hexToRgb(color);
      hslValue.textContent = hexToHsl(color);
      cmykValue.textContent = hexToCmyk(color);
    }

    // Generate color palettes
    function generateColorPalettes() {
      colorPaletteContainer.innerHTML = '';
      
      colorPalettes.forEach(palette => {
        palette.forEach(color => {
          const colorElement = document.createElement('div');
          colorElement.className = 'palette-color';
          colorElement.style.backgroundColor = color;
          colorElement.title = color;
          colorElement.onclick = () => selectPaletteColor(color, colorElement);
          colorPaletteContainer.appendChild(colorElement);
        });
      });
    }

    // Select palette color
    function selectPaletteColor(color, element) {
      // Remove active class from all palette colors
      document.querySelectorAll('.palette-color').forEach(el => el.classList.remove('active'));
      
      // Add active class to selected color
      element.classList.add('active');
      
      // Update color picker and display
      colorPicker.value = color;
      currentColor = color;
      updateColorDisplay(color);
      updateGradient();
    }

    // Set gradient type
    function setGradientType(type) {
      currentGradientType = type;
      
      // Update button states
      document.querySelectorAll('.gradient-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      updateGradient();
    }

    // Update gradient display
    function updateGradient() {
      const complementary = getComplementaryColor(currentColor);
      const analogous = getAnalogousColors(currentColor);
      
      let gradient;
      switch(currentGradientType) {
        case 'linear':
          gradient = `linear-gradient(135deg, ${currentColor}, ${complementary}, ${analogous[0]})`;
          break;
        case 'radial':
          gradient = `radial-gradient(circle, ${currentColor}, ${complementary}, ${analogous[0]})`;
          break;
        case 'conic':
          gradient = `conic-gradient(${currentColor}, ${complementary}, ${analogous[0]}, ${currentColor})`;
          break;
      }
      
      gradientDisplay.style.background = gradient;
    }

    // Copy to clipboard
    function copyToClipboard(type) {
      let textToCopy;
      
      switch(type) {
        case 'hex':
          textToCopy = hexValue.textContent;
          break;
        case 'rgb':
          textToCopy = rgbValue.textContent;
          break;
        case 'hsl':
          textToCopy = hslValue.textContent;
          break;
        case 'cmyk':
          textToCopy = cmykValue.textContent;
          break;
      }
      
      navigator.clipboard.writeText(textToCopy).then(() => {
        showCopyNotification();
      });
    }

    // Show copy notification
    function showCopyNotification() {
      copyNotification.classList.add('show');
      setTimeout(() => {
        copyNotification.classList.remove('show');
      }, 2000);
    }

    // Color conversion functions
    function hexToRgb(hex) {
      const bigint = parseInt(hex.slice(1), 16);
      const r = (bigint >> 16) & 255;
      const g = (bigint >> 8) & 255;
      const b = bigint & 255;
      return `rgb(${r}, ${g}, ${b})`;
    }

    function hexToHsl(hex) {
      const bigint = parseInt(hex.slice(1), 16);
      let r = (bigint >> 16) & 255;
      let g = (bigint >> 8) & 255;
      let b = bigint & 255;
      
      r /= 255;
      g /= 255;
      b /= 255;
      
      const max = Math.max(r, g, b);
      const min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;
      
      if (max === min) {
        h = s = 0;
      } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
      }
      
      return `hsl(${Math.round(h * 360)}, ${Math.round(s * 100)}%, ${Math.round(l * 100)}%)`;
    }

    function hexToCmyk(hex) {
      const bigint = parseInt(hex.slice(1), 16);
      let r = (bigint >> 16) & 255;
      let g = (bigint >> 8) & 255;
      let b = bigint & 255;
      
      r /= 255;
      g /= 255;
      b /= 255;
      
      const k = 1 - Math.max(r, Math.max(g, b));
      const c = (1 - r - k) / (1 - k) || 0;
      const m = (1 - g - k) / (1 - k) || 0;
      const y = (1 - b - k) / (1 - k) || 0;
      
      return `${Math.round(c * 100)}, ${Math.round(m * 100)}, ${Math.round(y * 100)}, ${Math.round(k * 100)}`;
    }

    function adjustBrightness(hex, percent) {
      const bigint = parseInt(hex.slice(1), 16);
      let r = (bigint >> 16) & 255;
      let g = (bigint >> 8) & 255;
      let b = bigint & 255;
      
      r = Math.max(0, Math.min(255, r + (r * percent / 100)));
      g = Math.max(0, Math.min(255, g + (g * percent / 100)));
      b = Math.max(0, Math.min(255, b + (b * percent / 100)));
      
      return `#${((1 << 24) + (Math.round(r) << 16) + (Math.round(g) << 8) + Math.round(b)).toString(16).slice(1)}`;
    }

    function getComplementaryColor(hex) {
      const bigint = parseInt(hex.slice(1), 16);
      const r = 255 - ((bigint >> 16) & 255);
      const g = 255 - ((bigint >> 8) & 255);
      const b = 255 - (bigint & 255);
      
      return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
    }

    function getAnalogousColors(hex) {
      // Simple analogous color generation
      const hsl = hexToHsl(hex);
      const hue = parseInt(hsl.match(/\d+/)[0]);
      
      const analogous1 = `hsl(${(hue + 30) % 360}, 73%, 66%)`;
      const analogous2 = `hsl(${(hue - 30 + 360) % 360}, 73%, 66%)`;
      
      return [analogous1, analogous2];
    }

    // Element SDK implementation
    async function onConfigChange(config) {
      const appTitle = document.getElementById('appTitle');
      const subtitleText = document.getElementById('subtitleText');
      const paletteTitle = document.getElementById('paletteTitle');
      const formTitle = document.getElementById('formTitle');
      
      if (appTitle) {
        appTitle.textContent = config.app_title || defaultConfig.app_title;
      }
      if (subtitleText) {
        subtitleText.textContent = config.subtitle_text || defaultConfig.subtitle_text;
      }
      if (paletteTitle) {
        paletteTitle.textContent = config.palette_title || defaultConfig.palette_title;
      }
      if (formTitle) {
        formTitle.textContent = config.form_title || defaultConfig.form_title;
      }
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.primary_color || defaultConfig.primary_color,
            set: (value) => {
              config.primary_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ primary_color: value });
              }
            }
          },
          {
            get: () => config.secondary_color || defaultConfig.secondary_color,
            set: (value) => {
              config.secondary_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ secondary_color: value });
              }
            }
          },
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              config.background_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ background_color: value });
              }
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              config.text_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          },
          {
            get: () => config.accent_color || defaultConfig.accent_color,
            set: (value) => {
              config.accent_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ accent_color: value });
              }
            }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["app_title", config.app_title || defaultConfig.app_title],
        ["subtitle_text", config.subtitle_text || defaultConfig.subtitle_text],
        ["palette_title", config.palette_title || defaultConfig.palette_title],
        ["form_title", config.form_title || defaultConfig.form_title]
      ]);
    }

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    // Initialize the app
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'998b32af57c88a3f',t:'MTc2MjE2NTg0NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>